{% include 'page_start.html' %}
{% include 'nav_bar.html' %}
<div class="container">
	
    <h2>{% if restore_dates %}Restore folder{% else %}Browse folder{% endif %}</h2>

    <ol class="breadcrumb">
        <li>
            <a href="/">Locations</a>
        </li>
        {% for parent in parents %}
        <li class="active">
            <a href="{{ url_for_browse(repo_path, parent.path) }}">
                {{ parent.name }}
            </a>
        </li>
        {% endfor %}
    </ol>

    <ul class="nav navbar nav-pills" role="navigation">
        <li {% if not restore_dates %}class="active"{% endif%}>
            <a href="{{ url_for_browse(repo_path, path) }}">Browse folder</a>
        </li>
        <li {% if restore_dates %}class="active"{% endif %}>
            <a href="{{ url_for_browse(repo_path, path, restore=True) }}">Restore folder</a>
        </li>
        <li>
            <a href="{{ url_for_history(repo_path) }}">View history</a>
        </li>
    </ul>

    {% include 'message.html' %}

    {% if not restore_dates %}
    <table id="files" class="sortable table">
        <thead>
            <tr>
                <th id="name" class="sortable" data-type="dir">Name</th>
                <th id="size" class="sortable" data-type="int">Size</th>
                <th id="last-revision" class="sortable" data-type="int">Revisions</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in dir_entries %}
            <tr class="{% if entry.exists %}exists{% else %}notexists{% endif %}">
                <td {% if entry.isdir %}data-value="dir-{{ entry.display_name }}"
                    {% else %}data-value="file-{{ entry.display_name }}"{% endif %}>
                    <a {% if entry.isdir %}
                        href="{{ url_for_browse(repo_path, entry.path) }}"
                        {% else %}
                        href="{{ url_for_restore(repo_path, entry.path, entry.last_change_date) }}"
                        {% endif %}
                        {% if entry.display_name | length > 45 %}
                        title="{{ entry.display_name }}"
                        {% endif %}>
                        <i {% if entry.isdir %}class="icon-folder"{% else %}class="icon-file"{% endif %}></i>
                        {% if entry.isdir %}<span class="sr-only">&lt;DIR&gt;</span>{% endif %}
                        {% if not entry.exists %}<span class="sr-only">&lt;DELETED&gt;</span>{% endif %}
                        {{ entry.display_name | truncate(45,True) }}
                    </a>
                </td>
                <td class="nowrap" data-value="{% if not entry.isdir %}{{ entry.file_size }}{% else %}0{% endif %}">
                    {% if not entry.isdir %}
                    {{ entry.file_size | filesize }}
                    {% endif %}
                </td>
                <td class="nowrap"  data-value="{{ entry.last_change_date.getSeconds() }}">
                	{% if entry.isdir %}
                    {{ entry.last_change_date | datetime }}
                    {% elif ( entry.change_dates | length ) > 1 %}
                    <div class="dropdown">
                        <button class="btn btn-link dropdown-toggle" type="button" id="menu1" data-toggle="dropdown">
                            {{ entry.last_change_date | datetime }}
                            <span class="badge">{{ entry.change_dates | length }}</span>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                            {% for change_date in entry.change_dates | reverse %}
                            <li>
                                <a href="{{ url_for_restore(repo_path, entry.path, change_date) }}">
                                    <!-- File date -->
                                    {{ change_date | datetime }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% else %}
                    {{ entry.last_change_date | datetime }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="panel panel-default">
        <div class="panel-heading clearfix">
            <div class="panel-title pull-left">
                Revisions ({{ restore_dates | length }})
            </div>
        </div>
	    <ul class="list-group">
			{% for restore_date in restore_dates | reverse %}
			<li class="list-group-item">
				<i class="icon-archive"></i>
	            {{ restore_date | datetime }}
	            <div class="pull-right">
	            	<a href="{{ url_for_restore(repo_path, path, restore_date) }}">
	            		Download
	            		<span class="label label-info"><i class="icon-file-archive"></i>
	            			ZIP</span></a>
	            	<a href="{{ url_for_restore(repo_path, path, restore_date, 'T') }}">
	        			Download
	        			<span class="label label-info"><i class="icon-file-archive"></i>
	        				TAR.GZ</span></a>
    			</div>
			</li>
			{% endfor %}
		</ul>
	</div>
    {% endif %}
</div>
{% include 'page_end.html' %}
