{% include 'page_start.html' %}
<!-- nav_bar -->
{% include 'nav_bar.html' %}
<!-- /nav_bar -->

<div class="container">
    <h2>Admin panel</h2>

    {% include 'message.html' %}

    <h3>Manage users</h3>

    <button type="button" class="btn btn-default" data-toggle="modal"
        data-target="#add-user-modal">Add user</button>

    <table class="table">
        <thead>
            <tr>
                <th>Username</th>
                <th>User root directory</th>
                <th>Is administrator</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <!--StartRepeat:users-->
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.user_root }}</td>
                <td>{% if user.is_admin %}Yes{% else %}No{% endif %}</td>
                <td>
                    <button type="button" class="btn btn-default btn-xs" data-toggle="modal"
                        data-target="#edit-user-{{ user.username }}-modal">Edit</button>
                    <button type="button" class="btn btn-default btn-xs" data-toggle="modal"
                        data-target="#delete-user-{{ user.username }}-modal">Delete</button>
                </td>
            </tr>
            {% endfor %}
            <!--EndRepeat:users-->
        </tbody>
    </table>

    {% import 'macros.html' as macros %}
    <form action="#" method="post" role="form" autocomplete="off">
        {% call macros.model_dialog('add-user-modal','Add user','Add user') %}
        <input type="hidden" name="action" value="add" >
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" name="username" value="" id="username"
                class="form-control" required>
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" name="password" id="password"
                class="form-control" required>
        </div>
        <div class="form-group">
            <label for="user-root">User root directory</label>
            <input type="text" name="user_root" id="user-root"
                value="{{ user_root }}" class="form-control" required>
        </div>
        <div class="checkbox">
            <label>
                <input type="checkbox" name="is_admin" >
                Is administrator
            </label>
        </div>
        {% endcall %}
    </form>
    
    {% for user in users %}
    <form action="#" method="post" role="form" autocomplete="off">
        {% set modalid = "edit-user-" + user.username + "-modal" %}
        <!-- #edit-user-{{ user.username }} -->
        {% call macros.model_dialog(modalid, 'Edit user ' + user.username, 'Save
        changes') %}
        <input type="hidden" name="action" value="edit" >
        <input type="hidden" name="username" value="{{ user.username }}" >
        <div class="form-group">
            <label for="{{ user.username }}-user-root">User root
                directory</label>
            <input type="text" class="form-control"
                id="{{ user.username }}-user-root" name="user_root"
                value="{{ user.user_root }}" >
        </div>
        <div class="checkbox">
            <label>
                <input type="checkbox" name="is_admin" {% if
                    user.is_admin%}checked="checked" {% endif %}>
                Is administrator
            </label>
        </div>
        {% endcall %}
    </form>
    {% endfor %}
    <!-- /#edit-user -->

    {% for user in users %}
    <form action="#" method="post" role="form" autocomplete="off">
        {% set modalid = "delete-user-" + user.username + "-modal" %}
        <!-- #delete-user-{{ user.username }} -->
        {% call macros.model_dialog(modalid, 'Delete user ' + user.username, 'Delete')
        %}
        <input type="hidden" name="action" value="delete" >
        <input type="hidden" name="username" value="{{ user.username }}" >
        Are you sure that you wish to delete user {{ user.username }}? {%
        endcall %}
    </form>
    {% endfor %}
    <!-- /#delete-user -->

</div>
{% include 'page_end.html' %}
